Параллельная обработка БД. Бесконечные ожидания и тупики.


Пусть транзакция _![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image002.png)_ проводит работу с элементом ![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image004.png), и доступ к элементу ![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image004.png) заблокирован этой транзакцией; _![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image006.png)_ находится в состоянии ожидания; транзакция _![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image008.png)_также запрашивает блокировку ![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image004.png), и этот запрос исполняется раньше, чем запрос _![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image006.png)_. Далее, в то время, когда блокировку установила транзакция _![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image008.png)_, ее запрашивает _![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image010.png)_, чьё требование удовлетворяется после разблокирования ![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image004.png) транзакцией _![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image008.png)_ и т.д. Не исключено, что транзакция _![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image006.png)_ будет пребывать в состоянии бесконечного ожидания.

Решение.Регистрировать все запросы и удовлетворять их в порядке очерёдности.

**_Тупик_** – ситуация, в которую попадает транзакция из некоторого множества ![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image012.png), содержащего не менее двух транзакций, в которых каждый из них желает блокировать элемент, блокированный другой транзакцией в данный момент.

Решение.

1)      Потребовать, чтобы каждая транзакция единовременно запрашивала все нужные ей блокировки. Система либо полностью удовлетворяет такой запрос, либо не предоставляет вообще никаких блокировок и заставляет данную транзакцию ждать до освобождение всех необходимых ей элементов.

2)      Производится некоторое линейное упорядочивание элементов и все транзакции должны запрашивать блокировки в этом порядке. Для транзакции, заблокировавшей некоторый элемент, гарантируется возможность заблокировать и все следующие за ним элементы.

3)      Ничего не предпринимать для предотвращения тупиков, а выполнять проверку на наличие ситуации тупика. Для этого строится граф,

–         вершины графа – транзакции,

–         дуга ![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image014.png) означает, что транзакция ![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image016.png) ожидает выполнения своего запроса на блокирование элемента, заблокированного в данный момент транзакцией ![](file:///C:/Users/BADF~1/AppData/Local/Temp/msohtmlclip1/01/clip_image018.png).

–         Если цикла нет,  то не существует и тупиков.

–         Если цикл есть, то надо

o   сделать рестарт хотя бы одной из попавших в тупик транзакций (удалить дугу) или

o   сделать откат транзакции (удалить вершину).


